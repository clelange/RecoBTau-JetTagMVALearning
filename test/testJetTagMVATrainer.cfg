#!/usr/bin/env cmsRun

process IPTrainer = {
	source = PoolSource {
		untracked vstring fileNames = { 
			"file:testTagInfos.root"
		}
	}

	include "FWCore/MessageLogger/data/MessageLogger.cfi"
	replace MessageLogger.cout.threshold = "INFO"

	include "RecoBTau/JetTagComputer/data/jetTagRecord.cfi"
	include "RecoBTag/ImpactParameter/data/impactParameterMVAComputer.cfi"

	module mcJetFlavour = MCJetFlavour {
		InputTag jets		= iterativeCone5CaloJets
		PSet jetFlavourIdentifier = {
			string mcSource			= "source"
			bool fillPartons		= true
			bool fillHeavyHadrons		= false
			bool fillLeptons		= false
			double coneSizeToAssociate	= 0.3
			bool physicsDefinition		= false
			bool rejectBCSplitting		= false
			vstring vetoFlavour		= { }
		}
	}

	service = PoolDBOutputService {
		string connect = "sqlite_file:MVAImpactParameterJetTags.db"
		string timetype = "runnumber"
		string BlobStreamerName = "TBufferBlobStreamer"

		VPSet toPut = {
			{
				string record = "BTauGenericMVAJetTagComputerRcd"
				string tag = "test_tag"
			}
		}

		PSet DBParameters = {
			untracked int32 messageLevel = 0
		}
	}

	module jetTagMVATrainerSave = JetTagMVATrainerSave {
		vstring toCopy = { }
		vstring toPut = { "ImpactParameter" }
	}

	module impactParameterMVATrainer = JetTagMVATrainer { 
		InputTag tagInfo		= impactParameterTagInfos
		string jetTagComputer		= "impactParameterMVAComputer"

		InputTag jetFlavourMatching	= mcJetFlavour
		bool useCategories		= false
		string calibrationRecord	= "ImpactParameter"
		vint32 ignoreFlavours		= { 0 }
		vint32 signalFlavours		= { 5, 7 }
		double minimumTransverseMomentum = 10.0
		double minimumPseudoRapidity	= 0
		double maximumPseudoRapidity	= 2.5
	}

	looper = JetTagMVATrainerLooper {
		VPSet trainers = {
			{
				string calibrationRecord = "ImpactParameter"
				untracked string trainDescription =
						"ImpactParameterMVATrainer.xml"
				untracked bool loadState = false
				untracked bool saveState = false
			}
		}
	}

	path p = {
		mcJetFlavour,
		impactParameterMVATrainer
	}

	endpath outpath = { jetTagMVATrainerSave }
}
