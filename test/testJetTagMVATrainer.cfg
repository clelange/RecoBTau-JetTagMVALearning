#!/usr/bin/env cmsRun

process IPTrainer = {
	source = PoolSource {
		untracked vstring fileNames = { 
			"file:testTagInfos.root"
		}
	}

	include "FWCore/MessageLogger/data/MessageLogger.cfi"

	include "RecoBTau/JetTagComputer/data/jetTagRecord.cfi"
	include "RecoBTag/ImpactParameter/data/impactParameterMVAComputer.cfi"

	include "PhysicsTools/JetMCAlgos/data/CaloJetsMCFlavour.cfi"

	sequence mcAlgoJetFlavour = { myPartons, IC5byRef, IC5byValAlgo }

	service = PoolDBOutputService {
		string connect = "sqlite_file:MVAImpactParameterJetTags.db"
		untracked string timetype = "runnumber"
		untracked string BlobStreamerName = "TBufferBlobStreamingService"

		VPSet toPut = {
			{
				string record = "BTauGenericMVAJetTagComputerRcd"
				string tag = "MVAJetTags_CMSSW_2_0_0_mc"
			}
		}

		PSet DBParameters = {
			untracked int32 messageLevel = 0
		}
	}

	module jetTagMVATrainerSave = JetTagMVATrainerSave {
		vstring toCopy = { }
		vstring toPut = { "ImpactParameter" }
	}

	module impactParameterMVATrainer = JetTagMVATrainer { 
		VInputTag tagInfos		= { impactParameterTagInfos }
		string jetTagComputer		= "impactParameterMVAComputer"

		InputTag jetFlavourMatching	= IC5byValAlgo
		bool useCategories		= false
		string calibrationRecord	= "ImpactParameter"
		vint32 ignoreFlavours		= { 0 }
		vint32 signalFlavours		= { 5, 7 }
		double minimumTransverseMomentum = 10.0
		double minimumPseudoRapidity	= 0
		double maximumPseudoRapidity	= 2.5
	}

	looper = JetTagMVATrainerLooper {
		VPSet trainers = {
			{
				string calibrationRecord = "ImpactParameter"
				untracked string trainDescription =
						"ImpactParameterMVATrainer.xml"
				untracked bool loadState = false
				untracked bool saveState = false
			}
		}
	}

	path p = {
		mcAlgoJetFlavour,
		impactParameterMVATrainer
	}

	endpath outpath = { jetTagMVATrainerSave }
}
