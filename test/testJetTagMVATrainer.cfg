#!/usr/bin/env cmsRun

process IPTrainer = {
	source = PoolSource {
		untracked vstring fileNames = { 
			"file:/storage/btag/saout/ttbar/ttbar_1_6_7.root"
		}
	}

	include "FWCore/MessageLogger/data/MessageLogger.cfi"
#	replace MessageLogger.cout.threshold = "INFO"

	include "RecoBTau/JetTagComputer/data/jetTagRecord.cfi"
	include "RecoBTag/TrackProbability/data/trackProbabilityFakeCondFile.cfi"
	include "RecoBTag/ImpactParameter/data/impactParameter.cff"

	include "RecoBTag/MCTools/data/mcJetFlavour.cff"

	service = PoolDBOutputService {
		string connect = "sqlite_file:MVAImpactParameterJetTags.db"
		string timetype = "runnumber"
		untracked uint32 authenticationMethod = 1
		untracked string catalog = "file:mycatalog.xml"

		VPSet toPut = {
			{
				string record = "BTauGenericMVAJetTagComputerRcd"
				string tag = "test_tag"
			}
		}

		PSet DBParameters = {
			untracked string authenticationPath = "."
			untracked int32 messageLevel = 0
			untracked bool loadBlobStreamer = true
		}
	}

	module jetTagMVATrainerSave = JetTagMVATrainerSave {
		vstring toCopy = { }
		vstring toPut = { "ImpactParameter" }
	}

	module impactParameterMVATrainer = JetTagMVATrainer { 
		InputTag tagInfo		= impactParameterTagInfos
		string jetTagComputer		= "impactParameterMVAComputer"

		InputTag jetFlavourMatching	= IC5byValAlgo
		bool useCategories		= false
		string calibrationRecord	= "ImpactParameter"
		vint32 ignoreFlavours		= { 0 }
		vint32 signalFlavours		= { 5, 7 }
		double minimumTransverseMomentum = 10.0
		double minimumPseudoRapidity	= 0
		double maximumPseudoRapidity	= 2.5
	}

	looper = JetTagMVATrainerLooper {
		VPSet trainers = {
			{
				string calibrationRecord = "ImpactParameter"
				untracked string trainDescription =
						"ImpactParameterMVATrainer.xml"
				untracked bool loadState = false
				untracked bool saveState = false
				untracked bool monitoring = true
			}
		}
	}

	path p = {
		mcAlgoJetFlavour,
		impactParameterTagInfos,
		impactParameterMVATrainer
	}

	endpath outpath = { jetTagMVATrainerSave }
}
